<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Portal Interativo ‚Äì Ensaios de Solos (Vol. 1)</title>
  <meta name="description" content="Curso interativo para iniciantes em ensaios de solos (ABNT). Volume 1: Umidade Natural e Granulometria.">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    :root {
      --blue:#013C5A; --gray:#666; --green:#28a745; --white:#FFF;
      --shadow:0 10px 30px rgba(1,60,90,.12);
    }
    body {
      margin:0; font-family:'Open Sans',sans-serif; color:var(--gray);
      background:linear-gradient(rgba(1,60,90,0.85),rgba(1,60,90,0.85)),
      url('./assets/background_portal.png') no-repeat center center fixed;
      background-size:cover; overflow-x:hidden;
    }
    header.site {
      position:sticky; top:0; background:rgba(255,255,255,.9);
      backdrop-filter:blur(8px); display:flex; justify-content:center; z-index:10;
    }
    nav { display:flex; flex-wrap:wrap; gap:8px; padding:10px; }
    nav a { color:var(--blue); text-decoration:none; font-weight:700; padding:6px 12px; border-radius:8px; }
    nav a.active { background:var(--blue); color:#fff; }
    main { padding:20px; max-width:1100px; margin:auto; background:rgba(255,255,255,0.92); border-radius:16px; box-shadow:var(--shadow); }
    footer { text-align:center; color:#fff; font-size:.85rem; padding:20px; }
    .progress-bar { background:#eef4f7; border-radius:999px; height:10px; overflow:hidden; margin-top:8px; }
    .progress-bar i { display:block; height:100%; width:0; background:#28a745; transition:width .3s; }
    #userHeader { position:fixed; top:10px; right:20px; display:none; align-items:center; gap:10px; background:rgba(1,60,90,0.55); border-radius:40px; padding:10px 16px; color:#fff; font-family:'Montserrat',sans-serif; }
    #logoutBtn { background:linear-gradient(135deg,#ff4e50,#f9d423); border:none; border-radius:30px; padding:6px 16px; color:#fff; font-weight:600; cursor:pointer; }
  </style>
</head>
<body>
  <header class="site">
    <nav>
      <a href="#home">In√≠cio</a>
      <a href="#index">√çndice</a>
      <a href="#mod0">M√≥dulo 0</a>
      <a href="#mod1">M√≥dulo 1</a>
      <a href="#mod2">M√≥dulo 2</a>
      <a href="#mod3">M√≥dulo 3</a>
      <a href="#mod4">M√≥dulo 4</a>
    </nav>
  </header>

  <header id="userHeader"><span id="userName">üëã Ol√°, aluno</span><button id="logoutBtn">Sair</button></header>

  <main id="home">
    <h2 style="color:var(--blue)">Bem-vindo ao Portal Interativo ‚Äì Ensaios de Solos (Vol. 1)</h2>
    <p>Explore os m√≥dulos do curso e acompanhe seu progresso. Seu avan√ßo √© salvo automaticamente no dispositivo.</p>
    <div><strong>Progresso geral:</strong>
      <div class="progress-bar"><i id="overall_bar"></i></div>
      <div id="overall_pct" style="font-weight:700;margin-top:4px">0%</div>
    </div>
  </main>

  <footer>¬© <span id="year"></span> Curso Interativo ‚Äì Ensaios de Solos (Vol. 1).</footer>

  <script>
    document.getElementById('year').textContent=new Date().getFullYear();

    function saveKV(k,v){try{localStorage.setItem(k,v);}catch(e){}}
    function loadKV(k){try{return localStorage.getItem(k);}catch(e){return null;}}

    function initChecks(){
      document.querySelectorAll('input.ck').forEach(el=>{
        const k=el.dataset.key;if(!k)return;
        const v=loadKV(k);if(v!==null)el.checked=v==='1';
        el.addEventListener('change',()=>{saveKV(k,el.checked?'1':'0');updateProgress();});
      });
      updateProgress();
    }

    function updateProgress(){
      const mods=['m0','m1','m2','m3','m4'];mods.forEach(m=>{
        const cbs=[...document.querySelectorAll(`[data-key^="${m}_ck_"]`)];
        const done=cbs.filter(x=>x.checked).length;
        const pct=cbs.length?(done/cbs.length)*100:0;
        saveKV(`${m}_progress_pct`,pct.toFixed(0));
      });
      updateOverallProgress();
    }

    function updateOverallProgress(){
      const mods=['m0','m1','m2'];let sum=0,c=0;
      mods.forEach(m=>{const pct=parseFloat(loadKV(`${m}_progress_pct`))||0;sum+=pct;c++;});
      const avg=c?Math.round(sum/c):0;
      const bar=document.getElementById('overall_bar');
      const txt=document.getElementById('overall_pct');
      if(bar)bar.style.width=avg+'%';if(txt)txt.textContent=avg+'%';
      saveKV('overall_progress_pct',avg);
    }

    window.addEventListener('DOMContentLoaded',initChecks);

  </script>

  <script type="module">
    import { initializeApp, getApps } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";
    const firebaseConfig = {
      apiKey:"AIzaSyDY5IFakVFbbLn8UQHUCgea7KOx_zZjvlY",
      authDomain:"portal-ensaios-solos-vol1.firebaseapp.com",
      projectId:"portal-ensaios-solos-vol1",
      storageBucket:"portal-ensaios-solos-vol1.firebasestorage.app",
      messagingSenderId:"217730071254",
      appId:"1:217730071254:web:a79fa9cbf49f742ff62777"
    };
    const app=getApps().length?getApps()[0]:initializeApp(firebaseConfig);
    const auth=getAuth(app);
    const headerEl=document.getElementById("userHeader");
    const nameEl=document.getElementById("userName");
    const logoutBtn=document.getElementById("logoutBtn");
    const LOGIN_URL="./index.html";

    onAuthStateChanged(auth,(user)=>{
      if(user){const nome=user.displayName||(user.email?user.email.split("@")[0]:"aluno");
        nameEl.textContent=`üëã Ol√°, ${nome}`;headerEl.style.display="flex";
      }else{headerEl.style.display="none";if(!location.href.includes("index.html"))window.location.href=LOGIN_URL;}
    });

    logoutBtn.addEventListener("click",async()=>{
      try{await signOut(auth);}finally{window.location.href=LOGIN_URL;}
    });
  </script>
</body>
</html>
